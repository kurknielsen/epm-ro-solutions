CREATE OR REPLACE TRIGGER ATTRIBUTE_VAL_UPDATE
	BEFORE INSERT OR UPDATE OF ATTRIBUTE_VAL ON TEMPORAL_ENTITY_ATTRIBUTE
	FOR EACH ROW
DECLARE
	v_ATTRIBUTE_TYPE ENTITY_ATTRIBUTE.ATTRIBUTE_TYPE%TYPE;
	v_NUMBER NUMBER;

BEGIN

	--DETERMINE WHAT TYPE OF ATTRIBUTE THIS IS SUPPOSED TO BE.
	SELECT UPPER(SUBSTR(ATTRIBUTE_TYPE,1,1))
	INTO v_ATTRIBUTE_TYPE
	FROM ENTITY_ATTRIBUTE
	WHERE ATTRIBUTE_ID = :new.ATTRIBUTE_ID;

	--MAKE SURE THE TYPE MATCHES UP.
	IF v_ATTRIBUTE_TYPE = 'B' THEN --BOOLEAN.
		IF UPPER(:new.ATTRIBUTE_VAL) IN ('0','F','FALSE') THEN
			:new.ATTRIBUTE_VAL := 0;
		ELSE
			:new.ATTRIBUTE_VAL := 1;
		END IF;
	ELSIF v_ATTRIBUTE_TYPE <> 'S' THEN --STRING.
--THIS CATCHES BOTH FLOAT AND INTEGER VALUES THAT ARE NON-NUMERIC.
		v_NUMBER := TO_NUMBER(:new.ATTRIBUTE_VAL);

		IF v_ATTRIBUTE_TYPE = 'I' THEN --INTEGER.
			:new.ATTRIBUTE_VAL := TO_CHAR(TRUNC(v_NUMBER));
		END IF;
	END IF;

EXCEPTION
	WHEN OTHERS THEN
	  :new.ATTRIBUTE_VAL := 0;

END ATTRIBUTE_VAL_UPDATE;

/ 
