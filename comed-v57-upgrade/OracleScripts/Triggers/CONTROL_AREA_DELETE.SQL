CREATE OR REPLACE TRIGGER CONTROL_AREA_DELETE
	AFTER DELETE ON CONTROL_AREA
	FOR EACH ROW
BEGIN
	UPDATE SERVICE_POINT SET CA_ID = 0 WHERE CA_ID = :old.CA_ID;
	DELETE TEMPORAL_ENTITY_ATTRIBUTE WHERE OWNER_ENTITY_ID = :old.CA_ID AND ATTRIBUTE_ID IN
		(SELECT A.ATTRIBUTE_ID FROM ENTITY_ATTRIBUTE A, ENTITY_DOMAIN B
		 WHERE UPPER(B.ENTITY_DOMAIN_TABLE_ALIAS) = 'CA' AND A.ENTITY_DOMAIN_ID = B.ENTITY_DOMAIN_ID);
	DELETE ENTITY_DOMAIN_CONTACT WHERE OWNER_ENTITY_ID = :old.CA_ID AND ENTITY_DOMAIN_ID IN
		(SELECT ENTITY_DOMAIN_ID FROM ENTITY_DOMAIN WHERE UPPER(ENTITY_DOMAIN_TABLE_ALIAS) = 'CA');
	DELETE ENTITY_DOMAIN_ADDRESS WHERE OWNER_ENTITY_ID = :old.CA_ID AND ENTITY_DOMAIN_ID IN
		(SELECT ENTITY_DOMAIN_ID FROM ENTITY_DOMAIN WHERE UPPER(ENTITY_DOMAIN_TABLE_ALIAS) = 'CA');
END CONTROL_AREA_DELETE;
/
