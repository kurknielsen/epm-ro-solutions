CREATE OR REPLACE TRIGGER TEMPORAL_ENT_ATTRIBUTE_UPDATE
	BEFORE UPDATE OR INSERT ON TEMPORAL_ENTITY_ATTRIBUTE
	FOR EACH ROW
DECLARE
    v_ATTRIBUTE_NAME TEMPORAL_ENTITY_ATTRIBUTE.ATTRIBUTE_NAME%TYPE;
    v_ENTITY_DOMAIN_ID TEMPORAL_ENTITY_ATTRIBUTE.ENTITY_DOMAIN_ID%TYPE;
BEGIN
--CHECK THAT THE DATE RANGE IS APPROPRIATE.
	IF :new.BEGIN_DATE > :new.END_DATE THEN
		ERRS.RAISE_BAD_DATE_RANGE(:new.BEGIN_DATE,:new.END_DATE, 'End Date must be later or equal to Begin Date.');
	END IF;
	
	BEGIN
    	SELECT ATTRIBUTE_NAME, ENTITY_DOMAIN_ID
    	INTO v_ATTRIBUTE_NAME, v_ENTITY_DOMAIN_ID
    	FROM ENTITY_ATTRIBUTE
    	WHERE ATTRIBUTE_ID = :new.ATTRIBUTE_ID;
    	
    	:new.ATTRIBUTE_NAME := v_ATTRIBUTE_NAME;
    	:new.ENTITY_DOMAIN_ID := v_ENTITY_DOMAIN_ID;
	EXCEPTION
		WHEN OTHERS THEN
			NULL; -- ignore it - leave the columns alone if we can't query the values here
	END;

END TEMPORAL_ENT_ATTRIBUTE_UPDATE;
/
