CREATE OR REPLACE TRIGGER INVOICE_LINE_ITEM_UPDATE
	BEFORE INSERT OR UPDATE OR DELETE ON INVOICE_LINE_ITEM
	FOR EACH ROW
BEGIN
	IF DELETING THEN
	    BEGIN
		UPDATE INVOICE	SET APPROVED_BY_ID = NULL
		WHERE INVOICE_ID = :old.INVOICE_ID;
	    EXCEPTION
		WHEN ERRS.e_TABLE_IS_MUTATING THEN
			NULL;	-- If this line is being deleted from INVOICE delete trigger, then
				-- a table is mutating exception is thrown - ignore it
	    END;
	ELSE
		UPDATE INVOICE	SET APPROVED_BY_ID = NULL, LAST_SENT_BY_ID = NULL
		WHERE INVOICE_ID = :new.INVOICE_ID;
	END IF;
END INVOICE_LINE_ITEM_UPDATE;
/
