CREATE OR REPLACE VIEW BID_OFFER_SET(TRANSACTION_ID, SCHEDULE_STATE, SCHEDULE_DATE, SET_NUMBER, QUANTITY, PRICE, STATUS) AS
SELECT A.TRANSACTION_ID,
	A.SCHEDULE_STATE,
	A.SCHEDULE_DATE,
	A.SET_NUMBER,
	TO_NUMBER(MAX(CASE WHEN A.TRAIT_INDEX = 2 /*TG.g_TI_OFFER_QUANTITY*/ THEN TRAIT_VAL ELSE NULL END)) "QUANTITY",
	TO_NUMBER(MAX(CASE WHEN A.TRAIT_INDEX = 1 /*TG.g_TI_OFFER_PRICE*/ THEN TRAIT_VAL ELSE NULL END)) "PRICE",
	'P' "STATUS"
FROM IT_TRAIT_SCHEDULE A
WHERE TRAIT_GROUP_ID = 1 /*TG.g_TG_OFFER_CURVE*/
	AND STATEMENT_TYPE_ID = 0
GROUP BY TRANSACTION_ID, SCHEDULE_STATE, SCHEDULE_DATE, TRAIT_GROUP_ID, SET_NUMBER;
/

CREATE OR REPLACE VIEW BID_OFFER_RAMP(TRANSACTION_ID, SCHEDULE_STATE, SCHEDULE_DATE, SET_NUMBER, RAMP_QUANTITY, RAMP_UP_RATE, RAMP_DOWN_RATE, STATUS) AS
SELECT A.TRANSACTION_ID,
	A.SCHEDULE_STATE,
	A.SCHEDULE_DATE,
	A.SET_NUMBER,
	TO_NUMBER(MAX(CASE WHEN A.TRAIT_INDEX = 1 /*TG.g_TI_RAMP_QUANTITY*/ THEN TRAIT_VAL ELSE NULL END)) "RAMP_QUANTITY",
	TO_NUMBER(MAX(CASE WHEN A.TRAIT_INDEX = 2 /*TG.g_TI_RAMP_UP_RATE*/ THEN TRAIT_VAL ELSE NULL END)) "RAMP_UP_RATE",
	TO_NUMBER(MAX(CASE WHEN A.TRAIT_INDEX = 3 /*TG.g_TI_RAMP_DOWN_RATE*/ THEN TRAIT_VAL ELSE NULL END)) "RAMP_DOWN_RATE",
	'P' "STATUS"
FROM IT_TRAIT_SCHEDULE A
WHERE TRAIT_GROUP_ID = 2 /*TG.g_TG_RAMP_CURVE*/
	AND STATEMENT_TYPE_ID = 0
GROUP BY TRANSACTION_ID, SCHEDULE_STATE, SCHEDULE_DATE, TRAIT_GROUP_ID, SET_NUMBER;
/

CREATE OR REPLACE VIEW BID_OFFER_STATUS AS
SELECT A.TRANSACTION_ID, A.SCHEDULE_DATE, A.CREATE_DATE, A.REVIEW_STATUS, A.REVIEW_DATE, NVL(R.USER_DISPLAY_NAME, R.USER_NAME) AS REVIEWED_BY, A.SUBMIT_STATUS, A.SUBMIT_DATE, NVL(S.USER_DISPLAY_NAME, S.USER_NAME) AS SUBMITTED_BY, A.MARKET_STATUS, A.MARKET_STATUS_DATE, A.REASON_FOR_CHANGE, A.OTHER_REASON, A.PROCESS_MESSAGE, A.ENTRY_DATE
FROM IT_TRAIT_SCHEDULE_STATUS A, APPLICATION_USER R, APPLICATION_USER S
WHERE R.USER_ID(+) = A.REVIEWED_BY_ID
  AND S.USER_ID(+) = A.SUBMITTED_BY_ID;
/

CREATE OR REPLACE VIEW BID_OFFER_TRAIT(TRANSACTION_ID, SCHEDULE_STATE, SCHEDULE_DATE, RESOURCE_TRAIT_ID, TRAIT_VAL, ENTRY_DATE) AS
SELECT A.TRANSACTION_ID,
	A.SCHEDULE_STATE,
	A.SCHEDULE_DATE,
	A.TRAIT_GROUP_ID "RESOURCE_TRAIT_ID",
	A.TRAIT_VAL,
	A.ENTRY_DATE
FROM IT_TRAIT_SCHEDULE A;
/

CREATE OR REPLACE VIEW TRANSACTION_TRAIT_ATTRIBUTES AS
SELECT TRAIT_GROUP_ID, TRAIT_INDEX, B.OBJECT_DISPLAY_NAME "DISPLAY_NAME", B.OBJECT_ORDER "DISPLAY_ORDER",
	MAX(CASE WHEN C.ATTRIBUTE_ID = 3 THEN ATTRIBUTE_VAL ELSE NULL END) "FORMAT",
	MAX(CASE WHEN C.ATTRIBUTE_ID = 4 THEN ATTRIBUTE_VAL ELSE NULL END) "DATA_TYPE",
	MAX(CASE WHEN C.ATTRIBUTE_ID = 6 THEN ATTRIBUTE_VAL ELSE NULL END) "EDIT_MASK",
	MAX(CASE WHEN C.ATTRIBUTE_ID = 5 THEN ATTRIBUTE_VAL ELSE NULL END) "COMBO_LIST",
	MAX(CASE WHEN C.ATTRIBUTE_ID = 7 THEN ATTRIBUTE_VAL ELSE NULL END) "AFTER_EDIT",
	A.SYSTEM_OBJECT_ID
FROM TRANSACTION_TRAIT A, SYSTEM_OBJECT B, SYSTEM_OBJECT_ATTRIBUTE C
WHERE B.OBJECT_ID = A.SYSTEM_OBJECT_ID
	AND C.OBJECT_ID = A.SYSTEM_OBJECT_ID
GROUP BY TRAIT_GROUP_ID, TRAIT_INDEX, B.OBJECT_ID, OBJECT_DISPLAY_NAME, OBJECT_ORDER, SYSTEM_OBJECT_ID;
/

CREATE OR REPLACE VIEW BID_OFFER_TEMPLATE AS
SELECT COMMODITY_ID, TRAIT_TEMPLATE_NAME "BID_OFFER_TEMPLATE_NAME", ROW_NUMBER, TEMPLATE_TYPE, TEMPLATE_DATA, ENTRY_DATE
FROM TRANSACTION_TRAIT_TEMPLATE;
/

