CREATE OR REPLACE VIEW CONTRACT_ACCOUNT_SERVICE ( CONTRACT_ID,BEGIN_DATE, END_DATE, ACCOUNT_SERVICE_ID )
AS SELECT DISTINCT CONTRACT_ID, BEGIN_DATE, NVL(END_DATE, HIGH_DATE), ACCOUNT_SERVICE_ID
FROM
	(SELECT A.CONTRACT_ID, A.BEGIN_DATE, A.END_DATE, C.ACCOUNT_SERVICE_ID
	FROM CONTRACT_ASSIGNMENT A, ACCOUNT_GROUP_ASSIGNMENT B, ACCOUNT_SERVICE C
	WHERE A.ENTITY_DOMAIN_ID = -260
		AND B.ACCOUNT_GROUP_ID = A.OWNER_ENTITY_ID
		AND UPPER(B.ASSIGNMENT_CATEGORY) = 'BILLING'
		AND C.ACCOUNT_ID = B.ACCOUNT_ID
	UNION SELECT A.CONTRACT_ID, A.BEGIN_DATE, A.END_DATE, B.ACCOUNT_SERVICE_ID
	FROM CONTRACT_ASSIGNMENT A, ACCOUNT_SERVICE B
	WHERE A.ENTITY_DOMAIN_ID = -170
		AND B.ACCOUNT_ID = A.OWNER_ENTITY_ID
	UNION SELECT A.CONTRACT_ID, A.BEGIN_DATE, A.END_DATE, B.ACCOUNT_SERVICE_ID
	FROM CONTRACT_ASSIGNMENT A, ACCOUNT_SERVICE B
	WHERE A.ENTITY_DOMAIN_ID = -180
		AND B.SERVICE_LOCATION_ID = A.OWNER_ENTITY_ID
	UNION SELECT A.CONTRACT_ID, A.BEGIN_DATE, A.END_DATE, B.ACCOUNT_SERVICE_ID
	FROM CONTRACT_ASSIGNMENT A, ACCOUNT_SERVICE B
	WHERE A.ENTITY_DOMAIN_ID = -190
		AND B.METER_ID = A.OWNER_ENTITY_ID) A;
