CREATE OR REPLACE PACKAGE ACCOUNT_AGGREGATION IS
-- $Revision: 1.40 $

FUNCTION WHAT_VERSION RETURN VARCHAR2;

PROCEDURE RUN_AGGREGATION
    (
    p_EDC_IDs IN NUMBER_COLLECTION,
    p_ESP_ID IN NUMBER,
    p_BEGIN_DATE IN DATE,
    p_END_DATE IN DATE,
    p_RESET_DATES IN NUMBER,
    p_TRACE_ON IN NUMBER,
    p_PROCESS_ID OUT VARCHAR2,
    p_PROCESS_STATUS OUT NUMBER,
    p_MESSAGE OUT VARCHAR2
    );

PROCEDURE RUN_TRANSACTIONAL_AGGREGATION
    (
    p_ACCOUNT_IDs IN NUMBER_COLLECTION,
    p_BEGIN_DATE IN DATE,
    p_END_DATE IN DATE,
    p_RESET_DATES IN NUMBER,
    p_TRACE_ON IN NUMBER,
    p_PROCESS_ID OUT VARCHAR2,
    p_PROCESS_STATUS OUT NUMBER,
    p_MESSAGE OUT VARCHAR2
    );

PROCEDURE GET_ACCOUNT_AGGREGATIONS
    (
    p_EDC_ID IN NUMBER,
    p_CURSOR IN OUT GA.REFCURSOR
    );

FUNCTION ENSURE_AGGREGATE_ACCOUNT
      (
      p_EDC_ID              IN NUMBER,
      p_CALENDAR_ID         IN NUMBER,
      p_METER_TYPE          IN VARCHAR2,
      p_MODEL_ID            IN NUMBER,
      p_SERVICE_POINT_ID    IN NUMBER := NULL,
      p_SERVICE_ZONE_ID     IN NUMBER := NULL,
      p_SCHEDULE_GROUP_ID   IN NUMBER := NULL,
      p_WEATHER_STATION_ID  IN NUMBER := NULL,
      p_LOSS_FACTOR_ID      IN NUMBER := NULL,
      p_REVENUE_PRODUCT_ID  IN NUMBER := NULL,
      p_COST_PRODUCT_ID     IN NUMBER := NULL,
      p_TOU_TEMPLATE_ID     IN NUMBER := NULL,
      p_BILL_CYCLE_ID       IN NUMBER := NULL,
      p_EDC_RATE_CLASS      IN VARCHAR2 := NULL,
      p_EDC_STRATA          IN VARCHAR2 := NULL,
      p_AGGREGATION_GROUP   IN VARCHAR2 := NULL,
      p_RESET_DATES         IN NUMBER := 1
      ) RETURN NUMBER;

PROCEDURE DEL_AGG_ACCOUNT_ENROLLMENT
    (
	p_BEGIN_DATE DATE, 
    p_END_DATE DATE
	);

PROCEDURE CAL_AGG_ACCOUNT_ENROLLMENT
    (
    p_BEGIN_DATE DATE,
    p_END_DATE DATE,
    p_EDC_ID NUMBER,
    p_ESP_ID NUMBER,
    p_PROCESS_ID OUT VARCHAR2,
    p_PROCESS_STATUS OUT NUMBER,
    p_MESSAGE OUT VARCHAR2
    );

PROCEDURE CAL_AGG_ACCOUNT_SERVICE_CONS
    (
    p_BEGIN_DATE DATE,
    p_END_DATE DATE,
    p_EDC_ID NUMBER,
    p_ESP_ID NUMBER,
    p_TRACE_ON IN NUMBER,
    p_PROCESS_ID OUT VARCHAR2,
    p_PROCESS_STATUS OUT NUMBER,
    p_MESSAGE OUT VARCHAR2
    );

PROCEDURE RUN_AGGREGATION_SIMPLE
    (
    p_EDC_IDs IN NUMBER_COLLECTION,
    p_ESP_ID IN NUMBER,
    p_BEGIN_DATE IN DATE,
    p_END_DATE IN DATE,
    p_RESET_DATES IN NUMBER,
    p_TRACE_ON IN NUMBER,
    p_PROCESS_ID OUT VARCHAR2,
    p_PROCESS_STATUS OUT NUMBER,
    p_MESSAGE OUT VARCHAR2
    );

$if $$UNIT_TEST_MODE = 1 $then

PROCEDURE ENSURE_ACCOUNT_ESP
    (
    p_AGGREGATE_ACCOUNT_ID IN NUMBER,
    p_ESP_ID IN NUMBER,
    p_POOL_ID IN NUMBER,
    p_BEGIN_DATE IN DATE,
    p_END_DATE IN DATE
    );

PROCEDURE ENSURE_SUB_AGG_AGGREGATION
    (
    p_ENTITY_ID IN NUMBER,
    p_ENTITY_TYPE IN VARCHAR2,
    p_BEGIN_DATE IN DATE,
    p_END_DATE IN DATE,
    p_AGG_ACCOUNT_ID IN NUMBER,
    p_ESP_ID IN NUMBER,
    p_POOL_ID IN NUMBER
    );

$end

END ACCOUNT_AGGREGATION;
/