CREATE OR REPLACE PROCEDURE GET_ENTITY
	(
	p_DOMAIN IN VARCHAR,
	p_OID IN NUMBER,
	p_NAME OUT VARCHAR
	)
	AS
	
-- Revision: $Revision: 1.17 $

-- ANSWER THE NAME OF THE ENTITY IN THE SPECIFIED DOMAIN IDENTIFIED BY THE OID
-- ANSWER A NULL VALUE IF THE ENTITY CANNOT BE FOUND

v_CURSOR NUMBER;
v_SELECT VARCHAR(128);
v_NUMROWS INTEGER;
v_NAME VARCHAR(64);
v_RC INTEGER;

BEGIN
	v_CURSOR := DBMS_SQL.OPEN_CURSOR;
	v_SELECT := 'SELECT ENTITY_NAME FROM ' || p_DOMAIN || ' WHERE ENTITY_ID =' || TO_CHAR(p_OID);				    DBMS_SQL.PARSE(v_CURSOR, v_SELECT, DBMS_SQL.NATIVE);
	DBMS_SQL.DEFINE_COLUMN(v_CURSOR, 1, v_NAME, 64);

	p_NAME := 'Name not found!';

	v_RC := DBMS_SQL.EXECUTE(v_CURSOR);

	LOOP
		IF DBMS_SQL.FETCH_ROWS(v_CURSOR) = 0 THEN
			EXIT;
		END IF;

		DBMS_SQL.COLUMN_VALUE(v_CURSOR, 1, v_NAME);
		p_NAME := v_NAME;
	END LOOP;

	DBMS_SQL.CLOSE_CURSOR(v_CURSOR);

	EXCEPTION
		WHEN OTHERS THEN
		DBMS_SQL.CLOSE_CURSOR(v_CURSOR);
		p_NAME := SUBSTR(SQLERRM, 1, 64);

END GET_ENTITY;
/
