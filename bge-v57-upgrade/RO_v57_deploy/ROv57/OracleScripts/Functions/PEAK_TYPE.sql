CREATE OR REPLACE FUNCTION PEAK_TYPE
	(
	p_DATE DATE,
	p_TIME_ZONE VARCHAR
	)
	RETURN VARCHAR IS
--Revision: $Revision: 1.17 $
--c	Set the type either on peak or off peak time
BEGIN
	IF TO_CHAR(p_DATE, 'DD-MON') = '01-JAN' THEN
	   RETURN 'OFF PEAK';
	ELSIF  TO_CHAR(p_DATE, 'DD-MON') = '04-JUL'  THEN
	   RETURN 'OFF PEAK';
	ELSIF  TO_CHAR(p_DATE, 'DD-MON') = '25-DEC' THEN
	   RETURN 'OFF PEAK';
	ELSIF OFF_PEAK_HOLIDAY(p_DATE) = 'TRUE' THEN
	   RETURN 'OFF PEAK';
	END IF;

	IF p_TIME_ZONE = 'EDT' OR p_TIME_ZONE = 'EST' THEN
	   IF TO_NUMBER(TO_CHAR(p_DATE, 'D')) <> 1 AND (TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) > 7 AND TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) < 24) THEN
	   	  RETURN 'ON PEAK';
	   ELSE
	   	  RETURN 'OFF PEAK';
	   END IF;

	ELSIF  p_TIME_ZONE = 'CST' OR p_TIME_ZONE = 'CDT' THEN
	   IF TO_NUMBER(TO_CHAR(p_DATE, 'D')) <> 1 AND (TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) > 6 AND TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) < 23) THEN
	   	  RETURN 'ON PEAK';
	   ELSE
	   	  RETURN 'OFF PEAK';
	   END IF;

	ELSIF p_TIME_ZONE = 'PST' OR p_TIME_ZONE = 'PDT' THEN
	   IF TO_NUMBER(TO_CHAR(p_DATE, 'D')) <> 1 AND (TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) > 6 AND TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) < 23) THEN
	   	  RETURN 'ON PEAK';
	   ELSE
	   	  RETURN 'OFF PEAK';
	   END IF;

	ELSIF p_TIME_ZONE = 'MST' OR p_TIME_ZONE = 'MDT' THEN
	   IF TO_NUMBER(TO_CHAR(p_DATE, 'D')) <> 1 AND (TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) > 7 AND TO_NUMBER(TO_CHAR(p_DATE, 'HH24')) < 24) THEN
	   	  RETURN 'ON PEAK';
	   ELSE
	   	  RETURN 'OFF PEAK';
	   END IF;

	END IF;
END PEAK_TYPE;


/

