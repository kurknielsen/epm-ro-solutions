CREATE OR REPLACE FUNCTION ACCOUNT_SERVICE_AS_OF_DATE
	(
	p_SERVICE_ID IN NUMBER,
	p_SERVICE_CODE IN CHAR,
	p_SERVICE_DATE DATE,
	p_AS_OF_DATE IN DATE
	) RETURN DATE IS
--Revision: $Revision: 1.17 $

-- Answer the maximun as of date that is less than or equal to the argument as of date.

v_AS_OF_DATE DATE := LOW_DATE;

BEGIN

	IF GA.ENABLE_VERSION_ACCOUNT_SERVICE THEN
		SELECT MAX(AS_OF_DATE)
		INTO v_AS_OF_DATE
		FROM ACCOUNT_SERVICE
		WHERE SERVICE_ID = p_SERVICE_ID
			AND SERVICE_CODE = p_SERVICE_CODE
			AND SERVICE_DATE = p_SERVICE_DATE
			AND AS_OF_DATE <= p_AS_OF_DATE;
	END IF;
	
	RETURN v_AS_OF_DATE;
	
	EXCEPTION
		WHEN NO_DATA_FOUND THEN
			RETURN v_AS_OF_DATE;
		WHEN OTHERS THEN
			RAISE;

END ACCOUNT_SERVICE_AS_OF_DATE;
/

