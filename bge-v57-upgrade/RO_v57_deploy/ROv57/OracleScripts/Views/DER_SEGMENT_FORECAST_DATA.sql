CREATE OR REPLACE VIEW DER_SEGMENT_FORECAST_DATA AS
SELECT DT.SERVICE_ZONE_ID,
			DT.SUB_STATION_ID,
			DT.FEEDER_ID,
			DT.FEEDER_SEGMENT_ID,
			DT.EXTERNAL_SYSTEM_ID,
			DT.SCENARIO_ID,
			DT.PROGRAM_ID,
			DT.RESULT_DATE,
			SUM(NVL(IS_EXT.IS_EXTERNAL, 0)) AS USE_EXTERNAL,
			SUM(
			CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.LOAD_VAL
			ELSE
				NULL
			END) AS LOAD_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.FAILURE_VAL
			ELSE
				NULL
			END) AS FAILURE_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.OPT_OUT_VAL
			ELSE
				NULL
			END) AS OPT_OUT_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.OVERRIDE_VAL
			ELSE
				NULL
			END) AS OVERRIDE_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.TX_LOSS_VAL
			ELSE
				NULL
			END) AS TX_LOSS_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.DX_LOSS_VAL
			ELSE
				NULL
			END) AS DX_LOSS_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.DER_COUNT
			ELSE
				NULL
			END) AS DER_COUNT,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.UNCONSTRAINED_LOAD_VAL
			ELSE
				NULL
			END) AS UNCONSTRAINED_LOAD_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.UNCONSTRAINED_TX_LOSS_VAL
			ELSE
				NULL
			END) AS UNCONSTRAINED_TX_LOSS_VAL,
			SUM(CASE WHEN NVL(IS_EXT.IS_EXTERNAL, 0) = DT.IS_EXTERNAL THEN
				DT.UNCONSTRAINED_DX_LOSS_VAL
			ELSE
				NULL
			END) AS UNCONSTRAINED_DX_LOSS_VAL
	FROM DER_SEGMENT_DATA DT,
		DER_SEG_RESULT_IS_EXTERNAL IS_EXT
	WHERE DT.SERVICE_CODE = 'F'
		AND DT.RESULT_DATE BETWEEN IS_EXT.CUT_BEGIN_DATE (+)
								AND IS_EXT.CUT_END_DATE (+)
		AND IS_EXT.PROGRAM_ID (+) = DT.PROGRAM_ID
		AND IS_EXT.SERVICE_ZONE_ID (+) = DT.SERVICE_ZONE_ID
		AND IS_EXT.EXTERNAL_SYSTEM_ID (+) = DT.EXTERNAL_SYSTEM_ID
		AND IS_EXT.SCENARIO_ID (+) = DT.SCENARIO_ID
	GROUP BY DT.RESULT_DATE, DT.SERVICE_ZONE_ID, DT.SUB_STATION_ID,
		DT.FEEDER_ID, DT.FEEDER_SEGMENT_ID, DT.PROGRAM_ID,
		DT.EXTERNAL_SYSTEM_ID, DT.SCENARIO_ID;
