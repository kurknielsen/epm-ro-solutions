CREATE OR REPLACE VIEW AGGREGATE_ACCOUNTS ( ACCOUNT_NAME, 
ACCOUNT_ID, EDC_ID, ESP_ID, POOL_ID, 
PSE_ID, CASE_ID, AGGREGATE_ID, SERVICE_DATE, 
AS_OF_DATE, SERVICE_ACCOUNTS, USAGE_FACTOR, ESP_TYPE, 
ESP_NAME ) AS
SELECT A.ACCOUNT_NAME, 
	A.ACCOUNT_ID, 
	B.EDC_ID, 
	C.ESP_ID, 
	C.POOL_ID, 
	D.PSE_ID, 
	E.CASE_ID, 
	E.AGGREGATE_ID, 
	E.SERVICE_DATE, 
	E.AS_OF_DATE, 
	E.SERVICE_ACCOUNTS, 
	E.USAGE_FACTOR, 
	F.ESP_TYPE, 
	F.ESP_NAME 
FROM ACCOUNT A, 
	ACCOUNT_EDC B, 
	AGGREGATE_ACCOUNT_ESP C, 
	PSE_ESP D, 
	AGGREGATE_ACCOUNT_SERVICE E, 
	ENERGY_SERVICE_PROVIDER F 
WHERE A.IS_AGGREGATE_ACCOUNT = 1 
	AND B.ACCOUNT_ID = A.ACCOUNT_ID 
	AND C.ACCOUNT_ID = B.ACCOUNT_ID 
	AND D.ESP_ID = C.ESP_ID 
	AND E.AGGREGATE_ID = C.AGGREGATE_ID 
	AND E.SERVICE_DATE BETWEEN B.BEGIN_DATE AND NVL(B.END_DATE, E.SERVICE_DATE) 
	AND E.SERVICE_DATE BETWEEN C.BEGIN_DATE AND NVL(C.END_DATE, E.SERVICE_DATE) 
	AND E.SERVICE_DATE BETWEEN D.BEGIN_DATE AND NVL(D.END_DATE, E.SERVICE_DATE) 
	AND F.ESP_ID = C.ESP_ID;
