--SET SERVEROUTPUT ON SIZE 500000
DECLARE

    PROCEDURE PUT_CONDITIONAL_FORMAT_ITEM
    (
    p_CONDITIONAL_FORMAT_NAME IN VARCHAR2,
    p_ITEM_NUMBER IN NUMBER,
	p_COLOR_WHEN_FORMULA IN VARCHAR,
	p_FOREGROUND_COLOR IN NUMBER,
	p_BACKGROUND_COLOR IN NUMBER,
	p_IS_BOLD IN NUMBER := 0,
	p_IS_ITALIC IN NUMBER := 0,
	p_IS_STRIKE_THROUGH IN NUMBER := 0,
	p_IS_UNDERLINE IN NUMBER := 0
    ) AS
        
    v_FORMAT_ID NUMBER(9) := 0;
        
	BEGIN
		
        -- Check for existing CONDITIONAL_FORMAT    
        BEGIN
            SELECT CF.CONDITIONAL_FORMAT_ID
            INTO v_FORMAT_ID
            FROM CONDITIONAL_FORMAT CF
            WHERE UPPER(CF.CONDITIONAL_FORMAT_NAME) = UPPER(LTRIM(RTRIM(p_CONDITIONAL_FORMAT_NAME)));
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                v_FORMAT_ID := 0;
        END;
        
        -- Insert/Update CONDITIONAL_FORMAT 
        BEGIN        
            IO.PUT_CONDITIONAL_FORMAT(v_FORMAT_ID, p_CONDITIONAL_FORMAT_NAME, '?', '?', v_FORMAT_ID, '?');            
            DBMS_OUTPUT.PUT_LINE('UPDATED FORMAT SUCCESSFULLY: ' || p_CONDITIONAL_FORMAT_NAME || '.  FORMAT_ID=' || v_FORMAT_ID);            
        EXCEPTION
		    WHEN OTHERS THEN
			    DBMS_OUTPUT.PUT_LINE('IO.PUT_CONDITIONAL_FORMAT:DID NOT SUCCESSFULLY CREATE ' || p_CONDITIONAL_FORMAT_NAME || '.  STATUS=' || SQLCODE);        
        END;                   
        
        -- Insert/Update CONDITIONAL_FORMAT_ITEM
        IF v_FORMAT_ID > 0 THEN 
            BEGIN
                EM.PUT_CONDITIONAL_FORMAT_ITEM(v_FORMAT_ID, p_ITEM_NUMBER, p_COLOR_WHEN_FORMULA, p_FOREGROUND_COLOR, p_BACKGROUND_COLOR, p_IS_BOLD, p_IS_ITALIC, p_IS_STRIKE_THROUGH, p_IS_UNDERLINE);
                DBMS_OUTPUT.PUT_LINE('UPDATED FORMAT ITEM SUCCESSFULLY: ' || p_CONDITIONAL_FORMAT_NAME || '.  FORMAT_ID=' || v_FORMAT_ID);
            EXCEPTION
		        WHEN OTHERS THEN
			        DBMS_OUTPUT.PUT_LINE('EM.PUT_CONDITIONAL_FORMAT_ITEM:DID NOT SUCCESSFULLY CREATE FORMAT ITEM: ' || p_CONDITIONAL_FORMAT_NAME);        
            END;
        ELSE        
            DBMS_OUTPUT.PUT_LINE('DID NOT CALL EM.PUT_CONDITIONAL_FORMAT_ITEM(). FORMAT ID <= 0.');        
        END IF;
    
    END;

BEGIN -- MAIN
   
    -- Load GEN_PJM_HOUR_TOTAL/GEN_PJM_DETAILS_TOTAL Conditional formats
    PUT_CONDITIONAL_FORMAT_ITEM('GEN_PJM_HOUR_TOTAL', 1, 'SCHEDULE_DATE_STR=" Total Row "', -16777216, -10053376);
    PUT_CONDITIONAL_FORMAT_ITEM('GEN_PJM_DETAILS_TOTAL', 1, 'RESOURCE_NAME=" Total "', -16777216, -10053376);
    COMMIT;
END;
/