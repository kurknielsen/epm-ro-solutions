CREATE OR REPLACE PACKAGE CX AS
--Revision $Revision: 1.94 $

-- Forecasting and Settlement Staging Cache Package.

FUNCTION WHAT_VERSION RETURN VARCHAR;

FUNCTION GET_ESP_SUPPLY_TYPE
	(
	p_ESP_ID IN NUMBER
	) RETURN CHAR;

FUNCTION GET_PSE_IS_BUG
	(
	p_PSE_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SERVICE_POINT_ID
	(
	p_SCHEDULE_GROUP_ID IN NUMBER,
	p_SERVICE_LOCATION_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SERVICE_ZONE_ID
	(
	p_SERVICE_LOCATION_ID IN NUMBER,
	p_SCHEDULE_GROUP_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_IS_WHOLESALE
	(
	p_SERVICE_LOCATION_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_IS_UFE_PARTICIPANT
	(
	p_ACCOUNT_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SCHEDULE_GROUP_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_SCHEDULE_COORDINATOR_ID
	(
	p_EDC_ID IN NUMBER,
	p_SCHEDULE_GROUP_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_CALENDAR_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_CAST_TYPE IN VARCHAR
	) RETURN NUMBER;

FUNCTION GET_PROXY_DAY_METHOD_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_CAST_TYPE IN VARCHAR
	) RETURN NUMBER;

FUNCTION GET_ALL_PROXY_DAY_METHOD_IDs RETURN ID_TABLE;

FUNCTION GET_SETTLEMENT_PROFILE_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_USAGE_FACTOR
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_TOU_USAGE_FACTOR_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_GROWTH_FACTOR
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_RUN_MODE IN NUMBER DEFAULT GA.DAY_MODE
	) RETURN NUMBER;

FUNCTION GET_AGGREGATE_SERVICE_ACCOUNTS
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_SERVICE_ACCOUNTS IN NUMBER,
	p_RUN_MODE IN NUMBER DEFAULT GA.DAY_MODE,
	p_APPLICATION_METHOD IN CHAR DEFAULT 'A'
	) RETURN NUMBER;

FUNCTION GET_LOSS_FACTOR_PATTERN
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_EDC_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_LOSS_FACTOR_TYPE IN VARCHAR,
	p_FAULT_CACHE IN BOOLEAN DEFAULT FALSE
	) RETURN GA.NUMBER_TABLE;

PROCEDURE GET_LOSS_FACTOR_PATTERN
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_EDC_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_FAULT_CACHE IN BOOLEAN DEFAULT FALSE,
    p_TX_LOSS_FACTOR_PATTERN OUT GA.NUMBER_TABLE,
    p_DX_LOSS_FACTOR_PATTERN OUT GA.NUMBER_TABLE,
    p_UE_LOSS_FACTOR_PATTERN OUT GA.NUMBER_TABLE
	);

FUNCTION GET_PRODUCT_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE,
	p_PRODUCT_TYPE IN VARCHAR
	) RETURN NUMBER;

FUNCTION GET_LOAD_OBLIGATION_ID
	(
	p_LOAD_OBLIGATION IN LOAD_OBLIGATION%ROWTYPE
	) RETURN NUMBER;

FUNCTION GET_SETTLEMENT_COUNT
	(
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_SERVICE_DELIVERY_ID
	(
	p_POOL_ID IN NUMBER,
	p_SERVICE_POINT_ID IN NUMBER,
	p_SERVICE_ZONE_ID IN NUMBER,
	p_SCHEDULE_GROUP_ID IN NUMBER,
	p_SC_ID IN NUMBER,
	p_SUPPLY_TYPE IN CHAR,
	p_IS_BUG IN NUMBER,
	p_IS_WHOLESALE IN NUMBER,
	p_IS_AGGREGATE_POOL IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SERVICE_ID
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE,
	p_PROVIDER_SERVICE_ID IN NUMBER,
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DELIVERY_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SERVICE_OBLIGATION_ID
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE,
	p_PROVIDER_SERVICE_ID IN NUMBER,
	p_SERVICE_DELIVERY_ID IN NUMBER
	) RETURN NUMBER;

PROCEDURE GET_SETTLEMENT_CANDIDATES
	(
	p_SERVICE_DATE IN DATE,
	p_CANDIDATES IN OUT NOCOPY GA.ID_TABLE
	);

FUNCTION GET_STATION_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_POOL_ID
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER,
	p_SERVICE_DATE IN DATE
	) RETURN NUMBER;

FUNCTION GET_IS_AGGREGATE_POOL
	(
	p_POOL_ID IN NUMBER
	) RETURN NUMBER;

FUNCTION GET_SERVICE_DELIVERY
	(
	p_SERVICE_DELIVERY_ID IN NUMBER
	) RETURN SERVICE_DELIVERY%ROWTYPE;

FUNCTION GET_ACCOUNT_SERVICE
	(
	p_ACCOUNT_SERVICE_ID IN NUMBER
	) RETURN ACCOUNT_SERVICE%ROWTYPE;

FUNCTION GET_PROVIDER_SERVICE
	(
	p_PROVIDER_SERVICE_ID IN NUMBER
	) RETURN PROVIDER_SERVICE%ROWTYPE;

PROCEDURE INITIALIZE_CACHE
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE,
	p_IDS IN ID_TABLE DEFAULT NULL
	);

PROCEDURE RELEASE_CACHE
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE DEFAULT NULL
	);

PROCEDURE SYNC_SERVICE_MODEL
	(
	p_SERVICE_MODEL IN OUT NOCOPY SERVICE_MODEL_TABLE,
	p_TRACE_ON IN BOOLEAN
	);

PROCEDURE SYNC_AGGREGATE_POOL
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE
	);

PROCEDURE SELECT_SERVICE_MODEL
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE,
	p_SERVICE_MODEL IN OUT NOCOPY SERVICE_MODEL_TABLE
	);

PROCEDURE TRACE_SERVICE_MODEL
	(
	p_CAST_CONTEXT IN CAST_CONTEXT_TYPE,
	p_SERVICE_MODEL IN SERVICE_MODEL_TABLE
	);

PROCEDURE TRACE_CALENDARS;

PROCEDURE TRACE_ACCOUNT_SERVICE_IDS;

PROCEDURE CACHE_LOAD_OBLIGATION;

PROCEDURE RELEASE_LOAD_OBLIGATION;

PROCEDURE CACHE_SERVICE_ACCOUNTS
	(
	p_BEGIN_DATE IN DATE,
	p_END_DATE IN DATE,
	p_IDS IN ID_TABLE DEFAULT NULL
	);

PROCEDURE TEST_ENROLLMENT
	(
	p_SERVICE_ACCOUNTS IN NUMBER,
	p_BEGIN_DATE IN DATE,
	p_END_DATE IN DATE,
	p_RUN_MODE IN NUMBER,
	p_APPLICATION_METHOD IN CHAR DEFAULT 'A'
	);
    
g_LOAD_OBLIGATION_CACHE LOAD_OBLIGATION_TABLE := LOAD_OBLIGATION_TABLE();

TYPE PSE_IS_BUG_CACHE IS TABLE OF NUMBER(1)  INDEX BY BINARY_INTEGER;
g_PSE_IS_BUG_CACHE PSE_IS_BUG_CACHE;

TYPE ESP_SUPPLY_TYPE_CACHE IS TABLE OF CHAR(1)  INDEX BY BINARY_INTEGER;
g_ESP_SUPPLY_TYPE_CACHE ESP_SUPPLY_TYPE_CACHE;

TYPE INTEGER_COLLECTION IS TABLE OF NUMBER(9)  INDEX BY BINARY_INTEGER;
TYPE INDEX_DIRECTORY_RECORD IS RECORD (START_INDEX BINARY_INTEGER, STOP_INDEX BINARY_INTEGER);
TYPE TIMED_VALUE_RECORD IS RECORD (BEGIN_DATE DATE, END_DATE DATE, DATA_VALUE NUMBER);
TYPE INDEX_DIRECTORY IS TABLE OF INDEX_DIRECTORY_RECORD INDEX BY BINARY_INTEGER;
TYPE TIMED_VALUE IS TABLE OF TIMED_VALUE_RECORD INDEX BY BINARY_INTEGER;

g_ACCOUNT_SERVICE_XREF INTEGER_COLLECTION;

g_SCHEDULE_GROUP_INDEX INDEX_DIRECTORY;
g_SCHEDULE_GROUP_CACHE TIMED_VALUE;

g_EDC_TX_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_EDC_TX_LOSS_FACTOR_CACHE TIMED_VALUE;

g_EDC_DX_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_EDC_DX_LOSS_FACTOR_CACHE TIMED_VALUE;

g_EDC_UE_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_EDC_UE_LOSS_FACTOR_CACHE TIMED_VALUE;

g_FORECAST_CALENDAR_INDEX INDEX_DIRECTORY;
g_FORECAST_CALENDAR_CACHE TIMED_VALUE;
g_FORECAST_PROXY_DAY_INDEX INDEX_DIRECTORY;
g_FORECAST_PROXY_DAY_CACHE TIMED_VALUE;
g_BACKCAST_CALENDAR_INDEX INDEX_DIRECTORY;
g_BACKCAST_CALENDAR_CACHE TIMED_VALUE;
g_BACKCAST_PROXY_DAY_INDEX INDEX_DIRECTORY;
g_BACKCAST_PROXY_DAY_CACHE TIMED_VALUE;

g_REVENUE_PRODUCT_INDEX INDEX_DIRECTORY;
g_REVENUE_PRODUCT_CACHE TIMED_VALUE;

g_COST_PRODUCT_INDEX INDEX_DIRECTORY;
g_COST_PRODUCT_CACHE TIMED_VALUE;

g_SETTLEMENT_PROFILE_INDEX INDEX_DIRECTORY;
g_SETTLEMENT_PROFILE_CACHE TIMED_VALUE;

g_USAGE_FACTOR_INDEX INDEX_DIRECTORY;
g_USAGE_FACTOR_CACHE TIMED_VALUE;

g_TX_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_TX_LOSS_FACTOR_CACHE TIMED_VALUE;

g_DX_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_DX_LOSS_FACTOR_CACHE TIMED_VALUE;

g_UE_LOSS_FACTOR_INDEX INDEX_DIRECTORY;
g_UE_LOSS_FACTOR_CACHE TIMED_VALUE;

g_GROWTH_ATTRITION_INDEX INDEX_DIRECTORY;
g_GROWTH_ATTRITION_CACHE TIMED_VALUE;

g_GROWTH_PATTERN_INDEX INDEX_DIRECTORY;
g_GROWTH_PATTERN_CACHE TIMED_VALUE;

g_TOU_USAGE_FACTOR_INDEX INDEX_DIRECTORY;
g_TOU_USAGE_FACTOR_CACHE TIMED_VALUE;

g_POOL_INDEX INDEX_DIRECTORY;
g_POOL_CACHE TIMED_VALUE;

g_IS_AGGREGATE_POOL_CACHE ID_TABLE := ID_TABLE();

TYPE GROWTH_PATTERN_TABLE  IS TABLE OF GROWTH_PATTERN%ROWTYPE INDEX BY BINARY_INTEGER;
g_GROWTH_PATTERN GROWTH_PATTERN_TABLE;

g_LOSS_FACTOR_PATTERN LOSS_FACTOR_PATTERN_TABLE := LOSS_FACTOR_PATTERN_TABLE();

g_AGGREGATE_GROWTH_INDEX INDEX_DIRECTORY;
g_AGGREGATE_GROWTH_CACHE AGGREGATE_ACCOUNT_GROWTH_TABLE := AGGREGATE_ACCOUNT_GROWTH_TABLE();

g_EDC_SCHEDULE_COORDINATOR GA.ID_TABLE;

TYPE SCHEDULE_GROUP_ATTRIBUTE IS RECORD
(
	SC_ID NUMBER(9),
	SERVICE_ZONE_ID NUMBER(9),
	SERVICE_POINT_ID NUMBER(9)
);
TYPE SCHEDULE_GROUP_ATTR_TBL IS TABLE OF SCHEDULE_GROUP_ATTRIBUTE INDEX BY BINARY_INTEGER;
g_SCHED_GROUP_ATTRIBUTES SCHEDULE_GROUP_ATTR_TBL;

g_WEATHER_STATION_CACHE ENTITY_XREF_TABLE := ENTITY_XREF_TABLE();

g_ALL NUMBER(2) := -1;
g_NOT_ASSIGNED NUMBER(1) := 0;
g_UNASSIGNED_CHAR CHAR(1) := '?';

END CX;
/