CREATE OR REPLACE TRIGGER PRODUCT_COMPONENT_UPDATE
	AFTER UPDATE OR INSERT ON PRODUCT_COMPONENT
	FOR EACH ROW

DECLARE
	v_PRODUCT PRODUCT%ROWTYPE;
	v_PRODUCT_BEGIN DATE;
	v_PRODUCT_END DATE;
	v_COMPONENT_BEGIN DATE;
	v_COMPONENT_END DATE;
BEGIN
--CHECK THAT THE ASSIGNMENT DATE RANGE IS WITHIN THE PRODUCT'S
	SELECT *
	INTO v_PRODUCT
	FROM PRODUCT
	WHERE PRODUCT_ID = :new.PRODUCT_ID;
	v_PRODUCT_BEGIN := v_PRODUCT.BEGIN_DATE;
	v_PRODUCT_END := NVL(v_PRODUCT.END_DATE,TO_DATE('31-DEC-9999','DD-MON-YYYY'));
	v_COMPONENT_BEGIN := :new.BEGIN_DATE;
	v_COMPONENT_END := NVL(:new.END_DATE,v_PRODUCT_END);
	IF v_COMPONENT_BEGIN < v_PRODUCT_BEGIN OR v_COMPONENT_END > v_PRODUCT_END OR
         v_COMPONENT_BEGIN > v_COMPONENT_END THEN
		ERRS.RAISE_BAD_DATE_RANGE(v_COMPONENT_BEGIN, v_COMPONENT_END, 'Component assignment date range cannot fall outside the Product''s date range');
	END IF;
END PRODUCT_COMPONENT_UPDATE;
/
