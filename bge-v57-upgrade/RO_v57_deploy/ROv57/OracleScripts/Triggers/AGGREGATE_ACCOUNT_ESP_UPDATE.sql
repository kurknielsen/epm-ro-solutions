CREATE OR REPLACE TRIGGER AGGREGATE_ACCOUNT_ESP_UPDATE
	AFTER UPDATE ON AGGREGATE_ACCOUNT_ESP
	FOR EACH ROW

DECLARE
v_BEGIN_START DATE;
v_BEGIN_STOP DATE;
v_END_START DATE;
v_END_STOP DATE;

BEGIN

	IF NOT GA.ENABLE_SERVICE_RETENTION THEN

-- Determine the Begin and End Date Ranges reflecting the User Specified date modifications.
		BEGIN_END_START_STOP_RANGE(:old.BEGIN_DATE, :new.BEGIN_DATE, :old.END_DATE, :new.END_DATE, v_BEGIN_START, v_BEGIN_STOP, v_END_START, v_END_STOP);

		DELETE AGGREGATE_ACCOUNT_SERVICE
		WHERE AGGREGATE_ID = :new.AGGREGATE_ID
			AND (SERVICE_DATE BETWEEN v_BEGIN_START AND v_BEGIN_STOP
			OR SERVICE_DATE BETWEEN v_END_START AND v_END_STOP);

	END IF;
	
END AGGREGATE_ACCOUNT_ESP_UPDATE;
/ 
