CREATE OR REPLACE TRIGGER SEASON_TEMPLATE_UPDATE
  AFTER UPDATE OR INSERT OR DELETE ON SEASON_TEMPLATE  
  FOR EACH ROW
DECLARE
  -- local variables here
BEGIN

	-- ANY SORT OF UPDATE TO SEASON_TEMPLATE INVALIDATES 
	-- TEMPLATE_DATES FOR THAT TEMPLATE
	
	DELETE FROM TEMPLATE_DATES TD
	WHERE TD.TEMPLATE_ID IN (:NEW.TEMPLATE_ID, :OLD.TEMPLATE_ID);
	
	DELETE FROM TEMPLATE_DAY_TYPE TDT
	WHERE TDT.TEMPLATE_ID IN (:NEW.TEMPLATE_ID, :OLD.TEMPLATE_ID);
	
	UPDATE TEMPLATE T
	SET T.VALIDATION_MESSAGE = 'The TEMPLATE_DATES records for this'
							|| ' template have been removed because they were invalidated when'
							|| ' associated SEASON_TEMPLATE records'
							|| ' were changed outside of the UI.'
	WHERE T.TEMPLATE_ID IN (:NEW.TEMPLATE_ID, :OLD.TEMPLATE_ID);
  
EXCEPTION
	WHEN ERRS.e_TABLE_IS_MUTATING THEN
		NULL;
END SEASON_TEMPLATE_UPDATE;
/
