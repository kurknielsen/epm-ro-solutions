-- Recalibrate The Associated System Load And Area Ids --
-- Retain 13 Months of Area Load Data
INSERT INTO SYSTEM_LOAD(SYSTEM_LOAD_ID, SYSTEM_LOAD_NAME, SYSTEM_LOAD_ALIAS, SYSTEM_LOAD_DESC, SYSTEM_LOAD_INTERVAL, ENTRY_DATE)
SELECT SYSTEM_LOAD_ID, SYSTEM_LOAD_NAME, SYSTEM_LOAD_ALIAS, SYSTEM_LOAD_DESC, SYSTEM_LOAD_INTERVAL, ENTRY_DATE FROM X_SYSTEM_LOAD;
INSERT INTO AREA(AREA_ID, AREA_NAME, AREA_ALIAS, AREA_DESC, AREA_INTERVAL, PROJECTION_PERIOD, ENTRY_DATE)
SELECT AREA_ID, AREA_NAME, AREA_ALIAS, AREA_DESC, AREA_INTERVAL, PROJECTION_PERIOD, ENTRY_DATE FROM X_AREA;
INSERT INTO SYSTEM_LOAD_AREA(SYSTEM_LOAD_ID, AREA_ID, OPERATION_CODE)
SELECT SYSTEM_LOAD_ID, AREA_ID, OPERATION_CODE FROM X_SYSTEM_LOAD_AREA;
INSERT INTO AREA_LOAD(CASE_ID, AREA_ID, LOAD_CODE, LOAD_DATE, AS_OF_DATE, LOAD_VAL)
SELECT CASE_ID, AREA_ID, LOAD_CODE, LOAD_DATE, AS_OF_DATE, LOAD_VAL FROM X_AREA_LOAD;
COMMIT;
DECLARE
v_SYSTEM_LOAD_ID NUMBER(9) := 101;
v_AREA_ID NUMBER(9) := 101;
BEGIN
   FOR v_SELECT IN (SELECT SYSTEM_LOAD_ID FROM SYSTEM_LOAD ORDER BY SYSTEM_LOAD_NAME) LOOP
      UPDATE SYSTEM_LOAD_AREA SET SYSTEM_LOAD_ID = v_SYSTEM_LOAD_ID WHERE SYSTEM_LOAD_ID = v_SELECT.SYSTEM_LOAD_ID;
      UPDATE SYSTEM_LOAD SET SYSTEM_LOAD_ID = v_SYSTEM_LOAD_ID WHERE SYSTEM_LOAD_ID = v_SELECT.SYSTEM_LOAD_ID;
      v_SYSTEM_LOAD_ID := v_SYSTEM_LOAD_ID + 1;
   END LOOP;
   FOR v_SELECT IN (SELECT AREA_ID FROM AREA ORDER BY AREA_NAME) LOOP
      UPDATE AREA SET AREA_ID = v_AREA_ID WHERE AREA_ID = v_SELECT.AREA_ID;
      UPDATE SYSTEM_LOAD_AREA SET AREA_ID = v_AREA_ID WHERE AREA_ID = v_SELECT.AREA_ID;
      UPDATE AREA_LOAD SET AREA_ID = v_AREA_ID WHERE AREA_ID = v_SELECT.AREA_ID;
      v_AREA_ID := v_AREA_ID + 1;
   END LOOP;
   COMMIT;
END;   
/

SELECT 'AREA_LOAD Record Count: ' || TO_CHAR(COUNT(*)) AS RECORD_COUNT FROM AREA_LOAD;
